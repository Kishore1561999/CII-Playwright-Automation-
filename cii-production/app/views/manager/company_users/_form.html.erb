<div class="card">
  <div class="card-body col-md-10 offset-1">
    <%= form_with(model: company_user, url: manager_company_user_path(company_user), local: true, html: { method: :put, class: "mb-3" }) do |f|  %>
      <%= f.hidden_field :email, :value => company_user.email, :id => "user_email" %>

      <div class="col-md-12 row g-3">
        <%= render "shared/error_messages", resource: company_user %>

        <div class="row">
          <h5 class="mb-2"><small class="text-light fw-semibold">Basic Info</small></h5>
          <div class="mb-3 col-md-4">
            <label class="form-label">Name</label>
            <%= f.text_field :company_name, class: "form-control", placeholder: "Enter company name" %>
          </div>
          <div class="mb-3 col-md-4">
            <label class="form-label">ISIN Number</label>
            <%= f.text_field :company_isin_number, class: "form-control", placeholder: "Enter company isin number" %>
          </div>
          <div class="mb-3 col-md-4">
            <label class="form-label">Sector</label>
            <%= f.select :company_sector, options_for_select(Sector.all.map { |sector| [sector.sector_name, sector.sector_name] }, company_user.company_sector), { include_blank: "Select sector" }, { class: "form-control form-select" } %>
          </div>
          <div class="mb-3 col-md-4">
            <label class="form-label">Description</label>
            <%= f.text_area :company_description, class: "form-control", placeholder: "Enter company description" %>
          </div>
          <div class="mb-3 col-md-4">
            <label class="form-label">Logo</label>
            <%= f.file_field :company_logo, class: "form-control" %>
          </div>
        </div>

        <div class="row">
          <h5 class="mb-2"><small class="text-light fw-semibold">Address Info</small></h5>
          <div class="mb-3 col-md-4">
            <label class="form-label">Address Line 1</label>
            <%= f.text_field :company_address_line1, class: "form-control", placeholder: "Enter address line 1" %>
          </div>
          <div class="mb-3 col-md-4">
            <label class="form-label">Address Line 2</label>
            <%= f.text_field :company_address_line2, class: "form-control", placeholder: "Enter address line 2" %>
          </div>
          <div class="mb-3 col-md-4">
            <label class="form-label">Country</label>
            <%= f.select :company_country, options_for_select(CS.countries.map { |country| [country[1], country[0]] }, company_user.company_country), { include_blank: "Select country" }, { class: "form-control form-select" } %>
          </div>
          <div class="mb-3 col-md-4">
            <label class="form-label">State</label>
            <%= f.select :company_state, options_for_select(CS.states(company_user.company_country).map { |state| [state[1], state[0]] }, company_user.company_state), { include_blank: "Select state" }, { class: "form-control form-select" } %>
          </div>
          <div class="mb-3 col-md-4">
            <label class="form-label">City</label>
            <%= f.select :company_city, options_for_select(CS.cities(company_user.company_state, company_user.company_country).map { |city| [city, city] }, company_user.company_city), { include_blank: "Select city" }, { class: "form-control form-select" } %>
          </div>
          <div class="mb-3 col-md-4">
            <label class="form-label">ZIP Code</label>
            <%= f.text_field :company_zip, class: "form-control", placeholder: "Enter zip code" %>
          </div>
        </div>

        <div class="row">
          <h5 class="mb-2"><small class="text-light fw-semibold">Primary Contact</small></h5>
          <div class="mb-3 col-md-4">
            <label class="form-label">Full Name</label>
            <%= f.text_field :primary_name, class: "form-control", placeholder: "Enter full name" %>
          </div>
          <div class="mb-3 col-md-4">
            <label class="form-label">Email</label>
            <%= f.text_field :primary_email, class: "form-control", placeholder: "Enter email" %>
          </div>
          <div class="mb-3 col-md-4">
            <label class="form-label">Designation</label>
            <%= f.text_field :primary_designation, class: "form-control", placeholder: "Enter designation" %>
          </div>
          <div class="mb-3 col-md-4">
            <label class="form-label">Contact Number</label>
            <%= f.text_field :primary_contact, class: "form-control", placeholder: "Enter contact number" %>
          </div>
        </div>

        <div class="row">
          <h5 class="mb-2"><small class="text-light fw-semibold">Alternate Contact</small></h5>
          <div class="mb-3 col-md-4">
            <label class="form-label">Full Name</label>
            <%= f.text_field :alternate_name, class: "form-control", placeholder: "Enter full name" %>
          </div>
          <div class="mb-3 col-md-4">
            <label class="form-label">Email</label>
            <%= f.text_field :alternate_email, class: "form-control", placeholder: "Enter email" %>
          </div>
          <div class="mb-3 col-md-4">
            <label class="form-label">Designation</label>
            <%= f.text_field :alternate_designation, class: "form-control", placeholder: "Enter designation" %>
          </div>
          <div class="mb-3 col-md-4">
            <label class="form-label">Contact Number</label>
            <%= f.text_field :alternate_contact, class: "form-control", placeholder: "Enter contact number" %>
          </div>
        </div>
      </div>

      <div class="col-md-4 offset-4">
        <center>
          <div class="row">
            <div class="col-md-12">
              <% if action_name == 'new' || action_name == 'create' %>
                <%= f.submit class: "btn btn-primary" %>
              <% end %>
              <%= link_to 'Cancel', url_for(:back), class: "btn btn-secondary" %>
            </div>
          </div>
        </center>
      </div>
    <% end %>
  </div>
</div>

<script>
  $(document).ready(function() {
    $("#user_primary_email").focusout(function() {
      $("#user_email").val($(this).val());
    });

    $("#user_company_country").change(function() {
      let input_state = $("#user_company_state");
      let input_city = $("#user_company_city");

      $.getJSON('/states/' + $(this).val(), function (data) {
        input_state.empty();
        input_state.append("<option value=''>Select state</option>");
        input_city.empty();
        input_city.append("<option value=''>Select city</option>");

        $.each(data, function (key, value) {
          var opt = '<option value='+ key +'>' + value + '</option>';
          input_state.append(opt);
        });
      });
    });

    $("#user_company_state").change(function() {
      let input_city = $("#user_company_city");

      $.getJSON('/cities/' + $(this).val(), function (data) {
        input_city.empty();
        input_city.append("<option value=''>Select city</option>");

        $.each(data, function (key, value) {
          var opt = '<option value='+ key +'>' + value + '</option>';
          input_city.append(opt);
        });
      });
    });
  });
</script>
